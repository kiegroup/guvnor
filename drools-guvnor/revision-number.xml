<?xml version="1.0"?>
<project name="Drools" basedir="." default="find_revision">
	 <property name="buildNumber" value="test"/>  
	 <property name="timestamp" value="timestamp"/>  
	
	<target name="find_revision" description="Sets property 'revision.number' to the head svn revision">  

		<property name="project.version" value="${project.version}"/>

		<exec executable="svnversion" outputproperty="svnlog.out" failifexecutionfails="false" >  
        	</exec>  

		<condition property="svnversionDoesNotWork">
  			<contains string="${svnlog.out}" substring="This client is too old" casesensitive="false" />
		</condition>

		<antcall target="write-version-and-build-number"/>
		<antcall target="write-version"/>

	</target>

	<!-- If svnversion works add the version and the build number -->
	<target name="write-version-and-build-number" unless="svnversionDoesNotWork">
        <touch file="./target/classes/org/drools/guvnor/public/version.txt" mkdirs="true"/>
		<echo file="./target/classes/org/drools/guvnor/public/version.txt">${project.version} ${svnlog.out}</echo>
	</target>

	<!-- If svnversion does not work just add the version -->
	<target name="write-version" if="svnversionDoesNotWork">
        <touch file="./target/classes/org/drools/guvnor/public/version.txt"/>
        <touch file="./target/classes/org/drools/guvnor/public/version.txt" mkdirs="true"/>
		<echo file="./target/classes/org/drools/guvnor/public/version.txt">${project.version}</echo>
	</target>
  
</project>
